# library

library('viridis')
library('ggplot2')
library('multcompView')
library('dplyr')

# Create data
data <- data.frame(
  vessel = c("O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	
             "O_96_0.25",	"O_96_0.55",    "O_96_0.55",	"O_96_0.55",	"O_96_0.55",	
             "O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	
             "O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_24_0.29",	
             "O_24_0.29",	"O_24_0.56", "□_24_0.55",	"□_24_0.55",	"□_24_0.55",	"T_0.25",	
             "T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	
             "O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	
             "O_48_0.29",	"O_48_0.29",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_0.55",	"□_24_0.55",	"□_24_0.55",	
             "T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_24_0.29",	"O_24_0.29",	"O_24_0.56",	"□_24_0.55",	"□_24_0.55",	"□_24_0.55",	"T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_0.55",	"□_24_0.55",	"□_24_0.55",	"T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.29",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10",	"T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10",					
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.29",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10",					
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10"),
  growth = c(8.632,	7.344,	8.526,	10.076,	7.716,	7.016,	11.878,	11.722,	9.48,	9.806,	10.816,	10.112,	10.266,	9.358,	10.654,	9.81,	8.358,	11.638,	10.664,	9.068,	14.056,	10.052,	9.782,	9.982,	5.488,	10.564,	4.78,	7.2,	9.4,
             7.148,	8.288,	8.338,	9.242,	7.642,	6.796,	7.858,	8.786,	7.238,	6.622,	7.884,	9.414,	9.424,	10.184,	10.074,	9.224,	8.858,	10.752,	10.176,	13.144,	13.472,	9.854,	9.59,	10.298,	6.826,	11.366,	5.326,	6.948,	8.242,
             6.914,	7.958,	6.052,	9.31,	6.984,	7.018,	8.416,	10.418,	7.974,	7.414,	8.104,	7.128,	8.418,	9.686,	10.868,	9.828,	8.766,	9.27,	10.346,	9.196,	12.798,	9.866,	9.76,	9.358,	6.21,	11.75,	5.744,	7.876,	9.696,
             6.728,	7.37,	7.612,	9.438,	6.162,	6.426,	8.306,	8.214,	6.46,	9.996,	8.614,	6.86,	10.45,	9.862,	9.244,	9.686,	9.428,	9.532,	10.222,	12.978,	13.158,	9.714,	9.98,	10.284,	5.852,	10.006,	5.3,	6.69,	9.158,
             6.474,	8.104,	7.442,	7.106,	6.618,	7.264,	8.342,	9.006,	5.94,	6.414,	7.662,	6.93,	13.856,	15.928,	15.348,	14.088,	13.88,	14.772,	11.156,	10.392,	12.652,	19.606,	19.218,	18.712,	5.526,	11.488,	6.192,	8.248,	10.392,
             10.104,	6.914,	5.836,	9.896,	8.452,	8.972,	8.058,	7.512,	6.53,	1.606,	7.006,	7.054,	15.202,	13.77,	14.212,	13.974,	12.938,	13.804,	10.328,	12.65,	12.948,	19.208,	18.82,	18.6,					
             6.89,	7.354,	6.738,	7.23,	6.026,	6.294,	7.732,	8.492,	6.93,	7.096,	10.504,	9.952,	16.034,	14.15,	14.286,	13.894,	13.646,	15.386,	11.692,	10.682,	13.74,	19.862,	19.214,	18.894,					
             7.894,	7.934,	7.528,	11.334,	7.844,	8.094,	9.206,	10.844,	9.978,	9.808,	9.91,	9.18,	17.24,	14.646,	15.064,	14.49,	15.652,	17.658,	10.606,	13.648,	14.744,	19.364,	19.042,	18.68))

# What is the effect of the treatment on the value ?
anova <- aov(growth ~ vessel, data = data)
summary(anova)

# Tukey test to study each pair of treatment :
tukey <- TukeyHSD(x = anova, 'vessel', conf.level = 0.95)
print(tukey)

# Tuckey test representation :
plot(tukey , las = 1, col = "brown")

# compact letter display
cld <- multcompLetters4(anova, tukey)
print(cld)

# table with factors and 3rd quantile
Tk <- group_by(data, vessel) %>%
  summarise(mean=mean(growth), quant = quantile(growth, probs = 0.75)) %>%
  arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$vessel)
Tk$cld <- cld$Letters

print(Tk)

# Create a vector named "new_order" containing the desired order
new_order <- with(data, reorder(vessel, growth, median, na.rm = TRUE))

# boxplot

ggplot(data, aes(x = new_order, growth)) + 
  geom_boxplot(aes(fill = factor(..middle..)), show.legend = FALSE) +
  labs(x = "", y = "growth [OD600]") +
  ylim(0,22) +
  ggtitle('Growth') +
  theme_bw(base_size = 20) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle = 90, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +  # Rotate x-axis labels
  geom_text(data = Tk, aes(x = vessel, y = quant, label = cld), size = 6, vjust = -1.75, hjust = -0.3) +
  scale_fill_viridis_d()


# saving the final figure
ggsave("boxplot_growth.png", width = 7, height = 7, dpi = 1000)