# library

library('viridis')
library('ggplot2')
library('multcompView')
library('dplyr')

# Create data
data <- data.frame(
  scale = c(1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	3,	3,	3,	3,	3,	3,	5,	5,	6,	7,	7,	7,	9,	10,	11,	12,	13,
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	3,	3,	3,	3,	3,	3,	5,	6,	6,	7,	7,	7,	9,	10,	11,	12,	13,
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	3,	3,	3,	3,	3,	3,	5,	5,	6,	7,	7,	7,	9,	10,	11,	12,	13,
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	3,	3,	3,	3,	3,	3,	5,	6,	6,	7,	7,	7,	9,	10,	11,	12,	13,
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	4,	4,	4,	4,	4,	4,	5,	5,	6,	8,	8,	8,	9,	10,	11,	12,	13,
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	4,	4,	4,	4,	4,	4,	5,	6,	6,	8,	8,	8,					
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	4,	4,	4,	4,	4,	4,	5,	5,	6,	8,	8,	8,					
                      1,	1,	1,	1,	1,	1,	2,	2,	2,	2,	2,	2,	4,	4,	4,	4,	4,	4,	5,	6,	6,	8,	8,	8),
  vessel = c("O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	
             "O_96_0.25",	"O_96_0.55",    "O_96_0.55",	"O_96_0.55",	"O_96_0.55",	
             "O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	
             "O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_24_0.29",	
             "O_24_0.29",	"O_24_0.56", "□_24_0.55",	"□_24_0.55",	"□_24_0.55",	"T_0.25",	
             "T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	
             "O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	
             "O_48_0.29",	"O_48_0.29",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_0.55",	"□_24_0.55",	"□_24_0.55",	
             "T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_24_0.29",	"O_24_0.29",	"O_24_0.56",	"□_24_0.55",	"□_24_0.55",	"□_24_0.55",	"T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_48_0.29",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_0.55",	"□_24_0.55",	"□_24_0.55",	"T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.29",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10",	"T_0.25",	"T_0.56",	"F_0.25",	"F_0.56",	"F_1.12",
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10",					
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.29",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10",					
             "O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.25",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_96_0.55",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_48_0.56",	"O_24_0.29",	"O_24_0.56",	"O_24_0.56",	"□_24_1.10",	"□_24_1.10",	"□_24_1.10"),
  prot = c(17660,	16400,	19540,	22280,	17740,	16960,	21740,	22660,	21980,	23900,	20940,	21740,	22120,	18340,	21660,	19660,	16940,	26960,	31740,	28340,	48360,	26480,	25460,	23760,	15320,	24300,	10520,	15100,	30240,
           15280,	16880,	19540,	20640,	17280,	15700,	17320,	22860,	17300,	15480,	17180,	20300,	19220,	17500,	17700,	17300,	17240,	25020,	27360,	46000,	44680,	27080,	24340,	24380,	14220,	25680,	10740,	15240,	28680,
           15780,	19000,	13180,	23000,	16520,	15960,	18380,	20800,	17880,	16560,	16040,	15800,	18480,	18080,	20600,	18240,	16300,	19480,	30600,	27220,	46700,	27580,	25540,	23400,	15460,	26540,	9960,	15240,	28540,
           13700,	15420,	16920,	20960,	14180,	14860,	17660,	19420,	15080,	21520,	17520,	16360,	20420,	18060,	16380,	17460,	17220,	20440,	28380,	46400,	44980,	26620,	24540,	23180,	12960,	26460,	10600,	16760,	32860,
           16000,	18220,	17120,	16740,	12420,	15800,	18560,	19500,	14200,	14720,	17600,	15700,	51440,	53600,	51520,	48740,	45960,	55300,	30880,	27520,	46520,	73200,	68740,	64320,	13700,	23680,	11400,	16680,	33540,
           24040,	15660,	11920,	22260,	19600,	22640,	17200,	16680,	15140,	6860,	15940,	16220,	54580,	45160,	48360,	46220,	41140,	52520,	27460,	45380,	47120,	70820,	64760,	65520,					
           16020,	16840,	14700,	16060,	13460,	13200,	15140,	17400,	14760,	15140,	19860,	20580,	56160,	47320,	47400,	45420,	47380,	62380,	33340,	27680,	46260,	66920,	68260,	61360,					
           14820,	17260,	17940,	27280,	17740,	17240,	20460,	24740,	21460,	21060,	20080,	20040,	65880,	51900,	54180,	52300,	54760,	68840,	27140,	48800,	46440,	68320,	62540,	60660))

# What is the effect of the treatment on the value ?
anova <- aov(prot ~ vessel, data = data)
summary(anova)

# Tukey test to study each pair of treatment :
tukey <- TukeyHSD(x = anova, 'vessel', conf.level = 0.95)
print(tukey)

# Tuckey test representation :
plot(tukey , las = 1, col = "brown")

# compact letter display
cld <- multcompLetters4(anova, tukey)
print(cld)

# table with factors and 3rd quantile
Tk <- group_by(data, vessel) %>%
  summarise(mean=mean(prot), quant = quantile(prot, probs = 0.75)) %>%
  arrange(desc(mean))

# extracting the compact letter display and adding to the Tk table
cld <- as.data.frame.list(cld$vessel)
Tk$cld <- cld$Letters

print(Tk)

# Create a vector named "new_order" containing the desired order
new_order <- with(data, reorder(vessel, prot, median, na.rm = TRUE))

# boxplot
ggplot(data, aes(x = new_order, y = prot)) +
  geom_boxplot(aes(fill = factor(..middle..)), show.legend = FALSE) +
  labs(x = "", y = "r-Prot [FL]") +
  ggtitle('Total r-Prot') +
  theme_bw(base_size = 20) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle = 90, hjust = 1),  # Rotate x-axis labels
        plot.title = element_text(hjust = 0.5)) +
  geom_text(data = Tk, aes(x = vessel, y = quant, label = cld), size = 6, vjust = -1, hjust = -0.5) +
  scale_fill_viridis_d(option='turbo')


# saving the final figure
ggsave("boxplot-prot.png", width = 7, height = 7, dpi = 1000)



